<!DOCTYPE html> 
<html lang="en"><head>
  <meta charset="UTF-8">
  <title>Vanish - Global Video Platform</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #1e1e2f 0%, #2a1e3c 100%);
      color: #d3c0f9;
      min-height: 100vh;
      overflow-x: hidden;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem 1rem;
    }

    .header {
      text-align: center;
      margin-bottom: 3rem;
      position: relative;
    }

    .creator-badge {
      position: absolute;
      top: -10px;
      right: 20px;
      font-size: 0.75rem;
      color: #a15fccaa;
      font-weight: 600;
      padding: 0.3rem 0.8rem;
      background: rgba(161, 95, 204, 0.1);
      border: 1px solid #a15fcc44;
      border-radius: 15px;
      backdrop-filter: blur(10px);
    }

    h1 {
      font-size: 3.5rem;
      margin: 0;
      background: linear-gradient(45deg, #a15fcc, #d3c0f9, #a15fcc);
      background-size: 200% 200%;
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: gradient-shift 3s ease-in-out infinite;
      text-shadow: 0 0 30px rgba(161, 95, 204, 0.5);
    }

    @keyframes gradient-shift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    .tagline {
      margin-top: 0.5rem;
      font-size: 1.1rem;
      opacity: 0.8;
      font-weight: 300;
    }

    .global-indicator {
      display: inline-block;
      margin-top: 0.5rem;
      padding: 0.3rem 0.8rem;
      background: rgba(72, 187, 120, 0.2);
      border: 1px solid rgba(72, 187, 120, 0.4);
      border-radius: 15px;
      color: #68d391;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .connection-status {
      display: inline-block;
      margin-left: 1rem;
      padding: 0.3rem 0.8rem;
      border-radius: 15px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .connection-status.connected {
      background: rgba(72, 187, 120, 0.2);
      border: 1px solid rgba(72, 187, 120, 0.4);
      color: #68d391;
    }

    .connection-status.disconnected {
      background: rgba(245, 101, 101, 0.2);
      border: 1px solid rgba(245, 101, 101, 0.4);
      color: #fc8181;
    }

    .security-indicator {
      display: inline-block;
      margin-left: 1rem;
      padding: 0.3rem 0.8rem;
      background: rgba(72, 187, 120, 0.2);
      border: 1px solid rgba(72, 187, 120, 0.4);
      border-radius: 15px;
      color: #d3c0f9;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .upload-section {
      background: rgba(46, 46, 68, 0.6);
      border: 2px solid rgba(161, 95, 204, 0.3);
      border-radius: 20px;
      padding: 2rem;
      margin-bottom: 3rem;
      backdrop-filter: blur(15px);
      box-shadow: 0 8px 32px rgba(161, 95, 204, 0.1);
      transition: all 0.3s ease;
    }

    .upload-section:hover {
      border-color: rgba(161, 95, 204, 0.6);
      box-shadow: 0 12px 40px rgba(161, 95, 204, 0.2);
    }

    .input-group {
      margin-bottom: 1.5rem;
    }

    .input-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: #d3c0f9;
    }

    input[type="text"], input[type="file"] {
      width: 100%;
      font-size: 1rem;
      padding: 0.8rem 1rem;
      background: rgba(42, 30, 60, 0.8);
      color: #d3c0f9;
      border: 2px solid rgba(161, 95, 204, 0.4);
      border-radius: 12px;
      transition: all 0.3s ease;
    }

    input[type="text"]:focus, input[type="file"]:focus {
      outline: none;
      border-color: #a15fcc;
      box-shadow: 0 0 0 3px rgba(161, 95, 204, 0.2);
    }

    .compression-options {
      background: rgba(42, 30, 60, 0.4);
      border: 1px solid rgba(161, 95, 204, 0.3);
      border-radius: 8px;
      padding: 1rem;
      margin-top: 1rem;
    }

    .compression-options h4 {
      margin: 0 0 0.5rem 0;
      color: #a15fcc;
      font-size: 0.9rem;
    }

    .quality-slider {
      width: 100%;
      margin: 0.5rem 0;
    }

    .quality-info {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      color: #a15fccaa;
    }

    .upload-btn {
      width: 100%;
      font-size: 1.1rem;
      font-weight: bold;
      padding: 1rem 2rem;
      background: linear-gradient(45deg, #a15fcc, #d3c0f9);
      color: #1e1e2f;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
        .countdown-timer {
      margin-top: 0.8rem;
      text-align: center;
      font-size: 1rem;
      font-weight: 500;
      color: #a15fcc;
      background: rgba(161, 95, 204, 0.15);
      border: 1px solid rgba(161, 95, 204, 0.3);
      border-radius: 10px;
      padding: 0.6rem 1rem;
      display: inline-block;
      box-shadow: 0 4px 12px rgba(161, 95, 204, 0.2);
      animation: fadeIn 0.5s ease;
    }


    .upload-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(161, 95, 204, 0.4);
    }

    .upload-btn:active {
      transform: translateY(0);
    }

    .upload-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    
        .upload-progress {
      width: 100%;
      height: 6px;
      background: rgba(161, 95, 204, 0.2);
      border-radius: 3px;
      overflow: hidden;
      margin-top: 1rem;
    }
    
    .upload-progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #a15fcc, #d3c0f9);
      border-radius: 3px;
      width: 0%;
      transition: width 0.3s ease;
    }
    
    .countdown-timer {
      margin-top: 0.75rem;
      font-size: 0.9rem;
      color: #d3c0f9;
      font-weight: 600;
    }


    .status {
      margin-top: 1rem;
      padding: 0.8rem;
      border-radius: 8px;
      text-align: center;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .status.success {
      background: rgba(72, 187, 120, 0.2);
      border: 1px solid rgba(72, 187, 120, 0.4);
      color: #68d391;
    }

    .status.error {
      background: rgba(245, 101, 101, 0.2);
      border: 1px solid rgba(245, 101, 101, 0.4);
      color: #fc8181;
    }

    .status.loading {
      background: rgba(161, 95, 204, 0.2);
      border: 1px solid rgba(161, 95, 204, 0.4);
      color: #d3c0f9;
    }

    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1.5rem;
      margin-top: 2rem;
    }

    .video-card {
      background: rgba(46, 46, 68, 0.6);
      border: 2px solid rgba(161, 95, 204, 0.2);
      border-radius: 16px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      position: relative;
    }

    .video-card:hover {
      transform: translateY(-5px);
      border-color: rgba(161, 95, 204, 0.6);
      box-shadow: 0 15px 35px rgba(161, 95, 204, 0.2);
    }

    .video-thumbnail {
      width: 100%;
      height: 160px;
      object-fit: cover;
      background: linear-gradient(45deg, #2a1e3c, #1e1e2f);
    }

    .video-info {
      padding: 1rem;
    }

    .video-title {
      font-size: 1.1rem;
      font-weight: bold;
      margin: 0 0 0.5rem 0;
      color: #d3c0f9;
      line-height: 1.3;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .video-meta {
      font-size: 0.85rem;
      color: #a15fccaa;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .global-badge {
      position: absolute;
      top: 0.5rem;
      left: 0.5rem;
      background: rgba(72, 187, 120, 0.8);
      color: white;
      padding: 0.2rem 0.5rem;
      border-radius: 6px;
      font-size: 0.7rem;
      font-weight: bold;
    }

    .video-page {
      display: none;
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .back-btn {
      background: rgba(161, 95, 204, 0.8);
      color: white;
      border: none;
      padding: 0.8rem 1.5rem;
      border-radius: 10px;
      font-weight: bold;
      cursor: pointer;
      margin-bottom: 2rem;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .back-btn:hover {
      background: #a15fcc;
      transform: translateX(-3px);
    }

    .video-player-container {
      text-align: center;
      margin-bottom: 2rem;
    }

    .video-player {
      max-width: 100%;
      max-height: 70vh;
      border-radius: 16px;
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
      background: #000;
    }

    .current-video-title {
      margin: 1rem 0;
      font-size: 1.8rem;
      font-weight: bold;
      color: #d3c0f9;
    }

    .empty-gallery {
      text-align: center;
      padding: 3rem;
      color: #a15fccaa;
      font-size: 1.1rem;
    }

    .upload-progress {
      width: 100%;
      height: 4px;
      background: rgba(161, 95, 204, 0.2);
      border-radius: 2px;
      overflow: hidden;
      margin-top: 1rem;
    }

    .upload-progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #a15fcc, #d3c0f9);
      border-radius: 2px;
      transition: width 0.3s ease;
      width: 0%;
    }

    .stats {
      text-align: center;
      margin-bottom: 2rem;
      padding: 1rem;
      background: rgba(46, 46, 68, 0.4);
      border-radius: 12px;
      border: 1px solid rgba(161, 95, 204, 0.2);
    }

    .stats-item {
      display: inline-block;
      margin: 0 1rem;
      color: #d3c0f9;
    }

    .stats-value {
      font-size: 1.5rem;
      font-weight: bold;
      color: #a15fcc;
    }

    .refresh-btn {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      background: rgba(161, 95, 204, 0.9);
      color: white;
      border: none;
      padding: 0.8rem;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.2rem;
      box-shadow: 0 4px 15px rgba(161, 95, 204, 0.3);
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .refresh-btn:hover {
      transform: scale(1.1) rotate(180deg);
      background: #a15fcc;
    }

    @media (max-width: 768px) {
      .container {
        padding: 1rem 0.5rem;
      }
      
      h1 {
        font-size: 2.5rem;
      }
      
      .gallery {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 1rem;
      }
      
      .creator-badge {
        position: static;
        display: inline-block;
        margin-top: 1rem;
      }

      .stats-item {
        display: block;
        margin: 0.5rem 0;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="creator-badge">Made By: U2FtIE0u</div>
      <h1>Vanish</h1>
      <p class="tagline"><em>Because forever is boring.</em></p>
      <div class="global-indicator">🌍 Platform Active</div>
      <div id="connectionStatus" class="connection-status connected">🟢 Connected to Servers</div>
      <div id="securityStatus" class="security-indicator" style="color: rgb(104, 211, 145);">🟢 Secured</div>
    </div>

    <div class="stats" id="statsSection">
      <div class="stats-item">
        <div class="stats-value" id="totalVideos">3</div>
        <div>Total Videos</div>
      </div>
      <div class="stats-item">
        <div class="stats-value" id="onlineUsers">0</div>
        <div>Active Users</div>
      </div>
      <div class="stats-item">
        <div class="stats-value" id="timeToMidnight">01:17</div>
        <div>Until Reset</div>
      </div>
    </div>

    <div id="uploadSection" class="upload-section" style="display: block;">
      <div class="input-group">
        <label for="titleInput">Video Title</label>
        <input type="text" id="titleInput" placeholder="Enter a title for your video" autocomplete="off" maxlength="100">
      </div>
      
      <div class="input-group">
        <label for="fileInput">Choose Video File</label>
        <input type="file" id="fileInput" accept="video/*">
        
        <div class="compression-options" id="compressionOptions" style="display: none;">
          <h4>🗜️ Auto-Compression Settings</h4>
          <div>
            <label for="qualitySlider">Quality Level:</label>
            <input type="range" id="qualitySlider" class="quality-slider" min="0.3" max="0.9" step="0.1" value="0.7">
            <div class="quality-info">
              <span>Lower Quality (Smaller File)</span>
              <span id="qualityValue">0.7</span>
              <span>Higher Quality (Larger File)</span>
            </div>
          </div>
          <div style="margin-top: 0.5rem; font-size: 0.8rem; color: #a15fccaa;">
            Auto-compression will reduce file size to fit Firebase limits while maintaining playback quality.
          </div>
        </div>
      </div>
      
      <button id="uploadBtn" class="upload-btn" type="button" disabled="">
        🌍 Upload Video
      </button>
      
     <div id="countdown" class="countdown-timer" style="display:none;">
      Estimated time left: <span id="countdownValue">00:00</span>
    </div>
    
    <div id="uploadProgress" class="upload-progress" style="display:none;">
        <div class="upload-progress-bar"></div>
    </div>


      
    <div id="countdown" class="countdown-timer" style="display:none;">
      Estimated time left: <span id="countdownValue">00:00</span>
    </div>
          
      <div id="status" class="status loading" style="display: none;">Loading video...</div>
    </div>

    <div id="gallery" class="gallery" style="display: grid;">
          <div class="video-card" onclick="vanishApp.showVideo(0)" data-index="0">
            <div class="global-badge">Watch Now</div>
            <img src="data:image/jpeg;base64,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" alt="comp test" class="video-thumbnail" loading="lazy">
            <div class="video-info">
              <h3 class="video-title">comp test</h3>
              <div class="video-meta">
                <span>Just now</span>
                <span>1.54 MB</span>
              </div>
              <div class="video-meta">
                <span>📍 Newton, KS</span>
                <span>👤 anon_acbjtj</span>
              </div>
            </div>
          </div>
        
          <div class="video-card" onclick="vanishApp.showVideo(1)" data-index="1">
            <div class="global-badge">Watch Now</div>
            <img src="data:image/jpeg;base64,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" alt="compression test" class="video-thumbnail" loading="lazy">
            <div class="video-info">
              <h3 class="video-title">compression test</h3>
              <div class="video-meta">
                <span>1h ago</span>
                <span>2.64 MB</span>
              </div>
              <div class="video-meta">
                <span>📍 Newton, KS</span>
                <span>👤 anon_hxkdyr</span>
              </div>
            </div>
          </div>
        
          <div class="video-card" onclick="vanishApp.showVideo(2)" data-index="2">
            <div class="global-badge">Watch Now</div>
            <img src="data:image/jpeg;base64,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" alt="glorp" class="video-thumbnail" loading="lazy">
            <div class="video-info">
              <h3 class="video-title">glorp</h3>
              <div class="video-meta">
                <span>8h ago</span>
                <span>2.72 MB</span>
              </div>
              <div class="video-meta">
                <span>📍 Newton, KS</span>
                <span>👤 anon_fuemoe</span>
              </div>
            </div>
          </div>
        </div>

    <div id="videoPage" class="video-page" style="display: none;">
      <button id="backBtn" class="back-btn">← Back to Gallery</button>
      <div class="video-player-container">
        <h2 id="videoTitle" class="current-video-title">comp test</h2>
        <video id="videoPlayer" class="video-player" controls="" preload="metadata" src=""></video>
      </div>
    </div>
  </div>

  <button id="refreshBtn" class="refresh-btn" title="Refresh Videos">🔄</button>

  <!-- Firebase SDK -->
  <script type="module">
    // Import Firebase modules
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, collection, addDoc, getDocs, onSnapshot, query, orderBy, deleteDoc, doc, where, setDoc, serverTimestamp, Timestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
    import { getAuth, signInAnonymously, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyC9ck4UFiLC8JRyUHonTszDd38CWnbIEZs",
      authDomain: "vanish-22814.firebaseapp.com",
      projectId: "vanish-22814",
      storageBucket: "vanish-22814.firebasestorage.app",
      messagingSenderId: "631925934112",
      appId: "1:631925934112:web:fcd0dbe49dbeb6eee69445",
      measurementId: "G-MKTXH9N4XT"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    console.log('🚀 Firebase initialized successfully!');

    class VanishGlobalPlatform {
      constructor() {
        console.log('📱 Initializing VanishGlobalPlatform with Firebase Authentication...');
        
        this.videos = [];
        this.db = db;
        this.auth = auth;
        this.isConnected = false;
        this.isAuthenticated = false;
        this.currentUser = null;
        this.maxFileSize = 2.9 * 1024 * 1024; // 2.9MB to stay under 3MB limit
        this.currentBlobUrls = new Set(); // Track blob URLs for cleanup
        this.userId = null; // Will be set after authentication
        this.userDocRef = null; // Reference to user's presence document
        this.activeUsers = 0; // Current active user count
        
        try {
          this.initializeElements();
          console.log('✅ Elements initialized');
          
          this.initializeEventListeners();
          console.log('✅ Event listeners initialized');
          
          this.initializeAuthentication();
          console.log('✅ Authentication started');
          
          this.startStatsUpdater();
          console.log('✅ Stats updater started');
          
          this.startMidnightCleaner();
          console.log('✅ Midnight cleaner started');
          
          console.log('🎉 Initialization complete!');
        } catch (error) {
          console.error('❌ Initialization failed:', error);
          this.updateConnectionStatus(false);
          this.updateSecurityStatus('error');
        }
      }

      initializeElements() {
        console.log('🔍 Finding DOM elements...');
        
        this.uploadBtn = document.getElementById('uploadBtn');
        this.fileInput = document.getElementById('fileInput');
        this.status = document.getElementById('status');
        this.titleInput = document.getElementById('titleInput');
        this.gallery = document.getElementById('gallery');
        this.videoPage = document.getElementById('videoPage');
        this.videoPlayer = document.getElementById('videoPlayer');
        this.videoTitle = document.getElementById('videoTitle');
        this.backBtn = document.getElementById('backBtn');
        this.uploadSection = document.getElementById('uploadSection');
        this.uploadProgress = document.getElementById('uploadProgress');
        this.uploadProgressBar = document.getElementById('uploadProgressBar');
        this.refreshBtn = document.getElementById('refreshBtn');
        this.totalVideos = document.getElementById('totalVideos');
        this.onlineUsers = document.getElementById('onlineUsers');
        this.timeToMidnight = document.getElementById('timeToMidnight');
        this.connectionStatus = document.getElementById('connectionStatus');
        this.securityStatus = document.getElementById('securityStatus');
        this.compressionOptions = document.getElementById('compressionOptions');
        this.qualitySlider = document.getElementById('qualitySlider');
        this.qualityValue = document.getElementById('qualityValue');
        this.uploadProgress = document.getElementById('uploadProgress');
        this.uploadProgressBar = this.uploadProgress.querySelector('.upload-progress-bar');
        this.countdown = document.getElementById('countdown');
        this.countdownValue = document.getElementById('countdownValue');
      }

      initializeEventListeners() {
        console.log('🎯 Setting up event listeners...');
        
        if (this.uploadBtn) {
          this.uploadBtn.addEventListener('click', (event) => {
            console.log('🔥 UPLOAD BUTTON CLICKED!');
            event.preventDefault();
            this.handleUpload();
          });
        }
        
        if (this.backBtn) {
          this.backBtn.addEventListener('click', () => {
            this.showGallery();
          });
        }
        
        if (this.refreshBtn) {
          this.refreshBtn.addEventListener('click', () => {
            this.loadVideosFromFirebase();
          });
        }
        
        if (this.fileInput) {
          this.fileInput.addEventListener('change', () => {
            this.handleFileSelection();
          });
        }
        
        if (this.titleInput) {
          this.titleInput.addEventListener('input', () => {
            this.validateForm();
          });
        }

        if (this.qualitySlider) {
          this.qualitySlider.addEventListener('input', (e) => {
            this.qualityValue.textContent = e.target.value;
          });
        }
      }

      async initializeAuthentication() {
        console.log('🔐 Initializing Firebase Authentication...');
        
        try {
          // Set up auth state listener
          onAuthStateChanged(this.auth, (user) => {
            if (user) {
              console.log('✅ User authenticated:', user.uid);
              this.currentUser = user;
              this.userId = user.uid;
              this.isAuthenticated = true;
              this.updateSecurityStatus('authenticated');
              this.initializeFirebase();
              this.initializeUserPresence();
            } else {
              console.log('❌ User not authenticated');
              this.isAuthenticated = false;
              this.updateSecurityStatus('unauthenticated');
            }
            this.validateForm();
          });

          // Sign in anonymously
          console.log('🔓 Signing in anonymously...');
          this.updateSecurityStatus('authenticating');
          
          const userCredential = await signInAnonymously(this.auth);
          console.log('✅ Anonymous sign-in successful:', userCredential.user.uid);
          
        } catch (error) {
          console.error('❌ Authentication failed:', error);
          this.updateSecurityStatus('error');
          this.showStatus(`Authentication failed: ${error.message}. Please refresh the page.`, 'error');
        }
      }

      updateSecurityStatus(status) {
        const securityStatus = this.securityStatus;
        
        switch (status) {
          case 'authenticating':
            securityStatus.textContent = '🔐 Authenticating...';
            securityStatus.style.color = '#d3c0f9';
            break;
          case 'authenticated':
            securityStatus.textContent = '🟢 Secured';
            securityStatus.style.color = '#68d391';
            break;
          case 'unauthenticated':
            securityStatus.textContent = '🔴 Authentication Required';
            securityStatus.style.color = '#fc8181';
            break;
          case 'error':
            securityStatus.textContent = '⚠️ Auth Error';
            securityStatus.style.color = '#fc8181';
            break;
        }
      }

async compressVideo(file, quality = 0.7) {
  console.log(`🗜️ Compressing video with quality: ${quality}`);

  return new Promise((resolve, reject) => {
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    const video = document.createElement('video');

    video.src = URL.createObjectURL(file);
    video.muted = true;
    video.preload = 'metadata';
    video.crossOrigin = 'anonymous';

    video.addEventListener('loadedmetadata', () => {
      const aspectRatio = video.videoWidth / video.videoHeight;

      let targetWidth = video.videoWidth;
      let targetHeight = video.videoHeight;

      if (quality < 0.5) {
        targetWidth = Math.floor(video.videoWidth * 0.6);
        targetHeight = Math.floor(video.videoHeight * 0.6);
      } else if (quality < 0.7) {
        targetWidth = Math.floor(video.videoWidth * 0.8);
        targetHeight = Math.floor(video.videoHeight * 0.8);
      }

      canvas.width = targetWidth;
      canvas.height = targetHeight;

      // Countdown element refs
      const countdownEl = document.getElementById('countdown');
      const countdownValue = document.getElementById('countdownValue');
      countdownEl.style.display = 'block';

      let remaining = Math.ceil(video.duration);

      // Format seconds to MM:SS
      const formatTime = (sec) => {
        const m = Math.floor(sec / 60).toString().padStart(2, '0');
        const s = (sec % 60).toString().padStart(2, '0');
        return `${m}:${s}`;
      };

      countdownValue.textContent = formatTime(remaining);

      // Setup countdown interval
      const timer = setInterval(() => {
        remaining--;
        countdownValue.textContent = formatTime(remaining);

        if (remaining <= 0) {
          clearInterval(timer);
          countdownEl.textContent = "✅ Compression finished!";
        }
      }, 1000);

      // Create a stream for the canvas (video)
      const videoStream = canvas.captureStream(24); // 24 fps

      // Extract audio track from the original file
      const audio = document.createElement('audio');
      audio.src = video.src;
      audio.crossOrigin = 'anonymous';
      audio.preload = 'metadata';

      audio.addEventListener('loadedmetadata', () => {
        const audioContext = new AudioContext();
        const source = audioContext.createMediaElementSource(audio);
        const dest = audioContext.createMediaStreamDestination();
        source.connect(dest);

        // Combine video + audio streams
        const combinedStream = new MediaStream([
          ...videoStream.getVideoTracks(),
          ...dest.stream.getAudioTracks(),
        ]);

        // Setup recorder
        const mediaRecorder = new MediaRecorder(combinedStream, {
          mimeType: 'video/webm;codecs=vp8,opus',
          videoBitsPerSecond: Math.floor(1000000 * quality),
        });

        const chunks = [];
        mediaRecorder.ondataavailable = (e) => {
          if (e.data.size > 0) chunks.push(e.data);
        };

        mediaRecorder.onstop = () => {
          clearInterval(timer);
          countdownEl.textContent = "✅ Compression finished!";

          const compressedBlob = new Blob(chunks, { type: 'video/webm' });
          console.log(`✅ Compression complete. Original: ${file.size} → Compressed: ${compressedBlob.size}`);

          const compressedFile = new File([compressedBlob],
            file.name.replace(/\.[^/.]+$/, '') + '_compressed.webm',
            { type: 'video/webm' }
          );

          URL.revokeObjectURL(video.src);
          resolve(compressedFile);
        };

        mediaRecorder.onerror = (error) => {
          clearInterval(timer);
          console.error('❌ Compression failed:', error);
          countdownEl.style.display = 'none';
          URL.revokeObjectURL(video.src);
          reject(error);
        };

        mediaRecorder.start();

        // Draw video frames
        const drawFrame = () => {
          if (video.currentTime < video.duration) {
            ctx.drawImage(video, 0, 0, targetWidth, targetHeight);
            requestAnimationFrame(drawFrame);
          } else {
            mediaRecorder.stop();
          }
        };

        // Start playing both muted and silent so no audio output
        video.play().then(() => {
          audio.play();
          drawFrame();
        });
      });

      audio.addEventListener('error', (e) => {
        clearInterval(timer);
        countdownEl.style.display = 'none';
        console.error('❌ Audio loading failed:', e);
        reject(e);
      });
    });

    video.addEventListener('error', (e) => {
      console.error('❌ Video loading failed:', e);
      reject(e);
    });
  });
}


      async initializeUserPresence() {
        if (!this.isAuthenticated || !this.currentUser) {
          console.log('⚠️ Cannot initialize presence - user not authenticated');
          return;
        }

        console.log('👥 Initializing user presence tracking...');
        
        try {
          // Create user presence document using authenticated user ID
          this.userDocRef = doc(this.db, 'active_users', this.currentUser.uid);
          
          await setDoc(this.userDocRef, {
            userId: this.currentUser.uid,
            lastSeen: serverTimestamp(),
            joinedAt: serverTimestamp(),
            userAgent: navigator.userAgent.substring(0, 100), // First 100 chars
            page: 'main'
          });
          
          console.log(`✅ User presence created: ${this.currentUser.uid}`);
          
          // Set up real-time active users listener
          this.setupActiveUsersListener();
          
          // Update presence every 30 seconds
          this.startPresenceUpdater();
          
          // Handle page visibility changes
          this.setupVisibilityHandlers();
          
        } catch (error) {
          console.error('❌ Failed to initialize user presence:', error);
        }
      }

      setupActiveUsersListener() {
        if (!this.isAuthenticated) return;
        
        console.log('👂 Setting up active users listener...');
        
        const activeUsersRef = collection(this.db, 'active_users');
        
        onSnapshot(activeUsersRef, (snapshot) => {
          const now = new Date();
          const fiveMinutesAgo = new Date(now.getTime() - 5 * 60 * 1000); // 5 minutes ago
          
          let activeCount = 0;
          const expiredUsers = [];
          
          snapshot.forEach((doc) => {
            const data = doc.data();
            const lastSeen = data.lastSeen?.toDate();
            
            if (lastSeen && lastSeen > fiveMinutesAgo) {
              activeCount++;
            } else {
              // Mark for cleanup
              expiredUsers.push(doc.id);
            }
          });
          
          this.activeUsers = activeCount;
          this.onlineUsers.textContent = activeCount;
          
          console.log(`👥 Active users: ${activeCount}`);
          
          // Clean up expired users (don't await to avoid blocking)
          this.cleanupExpiredUsers(expiredUsers);
          
        }, (error) => {
          console.error('❌ Active users listener error:', error);
          // Fallback to random number
          this.onlineUsers.textContent = Math.floor(Math.random() * 50) + 10;
        });
      }

      async cleanupExpiredUsers(expiredUserIds) {
        if (expiredUserIds.length === 0) return;
        
        console.log(`🧹 Cleaning up ${expiredUserIds.length} expired users...`);
        
        try {
          const deletePromises = expiredUserIds.map(userId => 
            deleteDoc(doc(this.db, 'active_users', userId))
          );
          
          await Promise.all(deletePromises);
          console.log(`✅ Cleaned up ${expiredUserIds.length} expired users`);
          
        } catch (error) {
          console.error('❌ Failed to cleanup expired users:', error);
        }
      }

      startPresenceUpdater() {
        if (!this.isAuthenticated) return;
        
        // Update presence every 30 seconds
        setInterval(async () => {
          if (this.userDocRef && !document.hidden && this.isAuthenticated) {
            try {
              await setDoc(this.userDocRef, {
                lastSeen: serverTimestamp(),
                page: this.getCurrentPage()
              }, { merge: true });
              
              console.log('💓 Presence heartbeat sent');
              
            } catch (error) {
              console.error('❌ Failed to update presence:', error);
            }
          }
        }, 30000); // 30 seconds
      }

      setupVisibilityHandlers() {
        // Handle page visibility changes
        document.addEventListener('visibilitychange', async () => {
          if (document.hidden) {
            console.log('👻 Page hidden, user went inactive');
          } else {
            console.log('👀 Page visible, user became active');
            // Update presence when user comes back
            if (this.userDocRef && this.isAuthenticated) {
              try {
                await setDoc(this.userDocRef, {
                  lastSeen: serverTimestamp(),
                  page: this.getCurrentPage()
                }, { merge: true });
              } catch (error) {
                console.error('❌ Failed to update presence on visibility change:', error);
              }
            }
          }
        });

        // Handle page unload
        window.addEventListener('beforeunload', () => {
          if (this.userDocRef && navigator.sendBeacon && this.isAuthenticated) {
            const cleanupData = JSON.stringify({
              action: 'cleanup_user',
              userId: this.currentUser?.uid
            });
            
            navigator.sendBeacon('/cleanup', cleanupData);
          }
        });

        // Fallback cleanup using pagehide
        window.addEventListener('pagehide', async () => {
          if (this.userDocRef && this.isAuthenticated) {
            try {
              await deleteDoc(this.userDocRef);
              console.log('👋 User presence cleaned up on page unload');
            } catch (error) {
              console.log('⚠️ Could not cleanup presence on unload');
            }
          }
        });
      }

      getCurrentPage() {
        if (this.videoPage.style.display !== 'none') {
          return 'video';
        }
        return 'main';
      }

      async initializeFirebase() {
        if (!this.isAuthenticated) {
          console.log('⚠️ Cannot initialize Firebase - user not authenticated');
          return;
        }

        try {
          console.log('🔥 Connecting to Firebase...');
          console.log('🌐 Testing network connectivity...');
          
          // Test basic network connectivity first
          try {
            const response = await fetch('https://www.google.com/favicon.ico', { 
              mode: 'no-cors',
              cache: 'no-cache'
            });
            console.log('✅ Network connectivity confirmed');
          } catch (networkError) {
            console.error('❌ Network connectivity issue:', networkError);
            this.updateConnectionStatus(false);
            this.showStatus('Network connection issue. Please check your internet connection.', 'error');
            return;
          }

          // Test Firebase connection with timeout
          console.log('🔥 Testing Firebase connection...');
          const testPromise = this.testFirebaseConnection();
          const timeoutPromise = new Promise((_, reject) => 
            setTimeout(() => reject(new Error('Firebase connection timeout')), 15000)
          );

          await Promise.race([testPromise, timeoutPromise]);
          
          // Test connection by getting videos
          await this.loadVideosFromFirebase();
          
          // Set up real-time listener
          this.setupRealtimeListener();
          
          this.updateConnectionStatus(true);
          console.log('✅ Firebase connected successfully!');
          
        } catch (error) {
          console.error('❌ Firebase connection failed:', error);
          this.updateConnectionStatus(false);
          
          if (error.message.includes('timeout')) {
            this.showStatus('Firebase connection timeout. Please refresh the page and try again.', 'error');
          } else if (error.code === 'permission-denied') {
            this.showStatus('Permission denied. Firebase security rules may be blocking access.', 'error');
          } else if (error.code === 'unavailable') {
            this.showStatus('Firebase service unavailable. Please try again later.', 'error');
          } else {
            this.showStatus(`Failed to connect to Firebase: ${error.message}. Please refresh and try again.`, 'error');
          }

          this.showFailsafeOptions();
        }
      }

      async testFirebaseConnection() {
        console.log('🧪 Testing Firebase read permissions...');
        
        try {
          // Try to read from videos collection (should work even if empty)
          const videosRef = collection(this.db, 'videos');
          const testQuery = query(videosRef);
          await getDocs(testQuery);
          console.log('✅ Firebase read test successful');
          
          // Try to write to active_users (test write permissions)
          console.log('🧪 Testing Firebase write permissions...');
          const testUserId = 'test_' + Date.now();
          const testUserRef = doc(this.db, 'active_users', this.currentUser.uid + '_test');
          await setDoc(testUserRef, {
            test: true,
            timestamp: serverTimestamp(),
            owner: this.currentUser.uid
          });
          
          // Clean up test document
          await deleteDoc(testUserRef);
          console.log('✅ Firebase write test successful');
          
        } catch (error) {
          console.error('❌ Firebase connection test failed:', error);
          throw error;
        }
      }

      showFailsafeOptions() {
        console.log('🆘 Showing failsafe options...');
        
        this.gallery.innerHTML = `
          <div class="empty-gallery">
            <h3 style="color: #fc8181; margin-bottom: 1rem;">🔥 Firebase Connection Failed</h3>
            <p>Unable to connect to the video database.</p>
            <br>
            <button onclick="location.reload()" style="
              background: linear-gradient(45deg, #a15fcc, #d3c0f9);
              color: #1e1e2f;
              border: none;
              padding: 1rem 2rem;
              border-radius: 12px;
              font-weight: bold;
              cursor: pointer;
              margin: 0.5rem;
            ">🔄 Retry Connection</button>
            <br><br>
            <details style="text-align: left; max-width: 600px; margin: 0 auto;">
              <summary style="cursor: pointer; color: #a15fcc; margin-bottom: 1rem;">🔧 Troubleshooting Steps</summary>
              <div style="background: rgba(46, 46, 68, 0.6); padding: 1rem; border-radius: 8px; font-size: 0.9rem;">
                <p><strong>Try these steps:</strong></p>
                <ol style="text-align: left; padding-left: 1.5rem;">
                  <li>Refresh the page (Ctrl+F5 or Cmd+Shift+R)</li>
                  <li>Check your internet connection</li>
                  <li>Disable ad blockers or browser extensions</li>
                  <li>Try a different browser or incognito mode</li>
                  <li>Check if your firewall/network blocks Firebase</li>
                  <li>Clear browser cache and cookies</li>
                </ol>
                <p style="margin-top: 1rem;"><strong>Firebase Domains to Whitelist:</strong></p>
                <ul style="text-align: left; padding-left: 1.5rem; font-family: monospace; font-size: 0.8rem;">
                  <li>*.googleapis.com</li>
                  <li>*.gstatic.com</li>
                  <li>vanish-22814.firebaseapp.com</li>
                  <li>firestore.googleapis.com</li>
                </ul>
              </div>
            </details>
          </div>
        `;
      }

      setupRealtimeListener() {
        if (!this.isAuthenticated) return;
        
        console.log('👂 Setting up real-time listener...');
        
        const videosRef = collection(this.db, 'videos');
        const q = query(videosRef, orderBy('uploadTime', 'desc'));
        
        onSnapshot(q, (snapshot) => {
          console.log('🔄 Real-time update received');
          console.log(`📊 Snapshot size: ${snapshot.size} documents`);
          
          this.videos = [];
          
          snapshot.forEach((doc) => {
            const data = doc.data();
            this.videos.push({
              id: doc.id,
              ...data
            });
          });
          
          this.renderGallery();
          console.log(`📊 Loaded ${this.videos.length} videos from real-time update`);
        }, (error) => {
          console.error('❌ Real-time listener error:', error);
          console.error('❌ Listener error details:', {
            code: error.code,
            message: error.message
          });
          
          this.updateConnectionStatus(false);
          
          if (error.code === 'permission-denied') {
            this.showStatus('Real-time updates blocked. Check Firebase security rules.', 'error');
          } else {
            this.showStatus(`Real-time connection lost: ${error.message}`, 'error');
          }
        });
      }

      async loadVideosFromFirebase() {
        if (!this.isAuthenticated) {
          console.log('⚠️ Cannot load videos - user not authenticated');
          return;
        }

        try {
          console.log('📥 Loading videos from Firebase...');
          console.log(`🔗 Connecting to project: vanish-22814`);
          
          const videosRef = collection(this.db, 'videos');
          const q = query(videosRef, orderBy('uploadTime', 'desc'));
          
          console.log('📡 Executing Firestore query...');
          const querySnapshot = await getDocs(q);
          
          this.videos = [];
          let videoCount = 0;
          
          querySnapshot.forEach((doc) => {
            const data = doc.data();
            this.videos.push({
              id: doc.id,
              ...data
            });
            videoCount++;
          });
          
          console.log(`📊 Successfully loaded ${videoCount} videos from Firebase`);
          console.log(`📋 Video IDs: ${this.videos.map(v => v.id).join(', ')}`);
          
          this.renderGallery();
          
        } catch (error) {
          console.error('❌ Failed to load videos:', error);
          console.error('❌ Error details:', {
            code: error.code,
            message: error.message,
            stack: error.stack
          });
          
          this.updateConnectionStatus(false);
          
          if (error.code === 'permission-denied') {
            console.error('🚫 Permission denied - check Firebase security rules');
            this.showStatus('Permission denied accessing videos. Firebase security rules may need updating.', 'error');
          } else if (error.code === 'unavailable') {
            console.error('📡 Firebase service unavailable');
            this.showStatus('Firebase service temporarily unavailable. Please try again.', 'error');
          } else if (error.message.includes('network')) {
            console.error('🌐 Network connectivity issue');
            this.showStatus('Network error. Check your internet connection and firewall settings.', 'error');
          } else {
            this.showStatus(`Database error: ${error.message}`, 'error');
          }
          
          throw error;
        }
      }

      updateConnectionStatus(connected) {
        this.isConnected = connected;
        
        if (connected) {
          this.connectionStatus.className = 'connection-status connected';
          this.connectionStatus.textContent = '🟢 Connected to Servers';
        } else {
          this.connectionStatus.className = 'connection-status disconnected';
          this.connectionStatus.textContent = '🔴 Firebase Disconnected';
        }
      }

      validateForm() {
        const hasTitle = this.titleInput.value.trim().length > 0;
        const hasFile = this.fileInput.files.length > 0;
        
        this.uploadBtn.disabled = !hasTitle || !hasFile || !this.isConnected || !this.isAuthenticated;
        return hasTitle && hasFile && this.isConnected && this.isAuthenticated;
      }

      async handleUpload() {
        console.log('🚀 STARTING SECURE FIREBASE UPLOAD!');
        
        try {
          if (!this.isAuthenticated) {
            this.showStatus('Authentication required. Please wait for authentication to complete.', 'error');
            return;
          }

          if (!this.isConnected) {
            this.showStatus('Not connected to Firebase. Please check your internet connection.', 'error');
            return;
          }

          if (!this.validateForm()) {
            this.showStatus('Please fill in all fields before uploading.', 'error');
            return;
          }

          let file = this.fileInput.files[0];
          const title = this.titleInput.value.trim();
          const quality = parseFloat(this.qualitySlider.value);

          console.log(`📤 Starting secure upload process: "${title}" (${file.size} bytes)`);
          console.log(`👤 Authenticated user: ${this.currentUser.uid}`);
          
          this.uploadBtn.disabled = true;
          this.showProgress(5);

          // Check if compression is needed
          if (file.size > this.maxFileSize) {
            this.showStatus('🗜️ File too large, compressing video...', 'loading');
            this.showProgress(10);
            
            try {
              file = await this.compressVideo(file, quality);
              console.log(`✅ Compression complete. New size: ${file.size} bytes`);
              this.showProgress(40);
              
              if (file.size > this.maxFileSize) {
                console.log('📉 Still too large, trying lower quality...');
                this.showStatus('🗜️ Applying maximum compression...', 'loading');
                file = await this.compressVideo(this.fileInput.files[0], 0.3);
                this.showProgress(50);
                
                if (file.size > this.maxFileSize) {
                  throw new Error('File too large even after maximum compression');
                }
              }
            } catch (compressionError) {
              console.error('❌ Compression failed:', compressionError);
              this.showStatus('Failed to compress video. Please try a smaller file.', 'error');
              return;
            }
          } else {
            this.showProgress(40);
          }

          this.showStatus('Converting video to base64...', 'loading');
          this.showProgress(50);

          // Convert video to base64
          const videoBase64 = await this.fileToBase64(file);
          this.showProgress(60);

          // Generate thumbnail
          this.showStatus('Generating thumbnail...', 'loading');
          const thumbnailData = await this.generateThumbnail(file);
          this.showProgress(70);

          // Prepare video data with owner field for security rules
          const videoId = Date.now().toString() + Math.random().toString(36).substr(2, 9);
          const maxChunkSize = 800000; // 800KB chunks
          
          this.showStatus('Preparing secure upload...', 'loading');
          this.showProgress(75);

          if (videoBase64.length > maxChunkSize) {
            // Large video - chunk it
            console.log('📦 Video is large, chunking into multiple documents...');
            await this.uploadChunkedVideo(videoId, title, videoBase64, thumbnailData, file);
          } else {
            // Small video - upload normally
            console.log('📄 Video is small, uploading as single document...');
            await this.uploadSingleVideo(videoId, title, videoBase64, thumbnailData, file);
          }

          this.showProgress(100);
          
          // Clear form
          this.titleInput.value = '';
          this.fileInput.value = '';
          this.compressionOptions.style.display = 'none';

          this.showStatus('🎉 Video uploaded securely! Everyone can see it now!', 'success');
          
          setTimeout(() => {
            this.hideStatus();
            this.hideProgress();
          }, 3000);

        } catch (error) {
          console.error('❌ Secure Firebase upload failed:', error);
          
          if (error.code === 'failed-precondition' || error.message.includes('maximum allowed size')) {
            this.showStatus('Video too large for Firebase! Try a smaller file.', 'error');
          } else if (error.code === 'permission-denied') {
            this.showStatus('Permission denied. Upload blocked by security rules.', 'error');
          } else if (error.message.includes('too large')) {
            this.showStatus('Video file too large. Please try a smaller video.', 'error');
          } else {
            this.showStatus(`Upload failed: ${error.message}`, 'error');
          }
        } finally {
          this.uploadBtn.disabled = false;
        }
      }

      async uploadSingleVideo(videoId, title, videoBase64, thumbnailData, file) {
        console.log('📄 Uploading single document with security...');
        
        const videoData = {
          id: videoId,
          title: title,
          videoData: videoBase64,
          thumbnail: thumbnailData,
          uploadTime: new Date().toISOString(),
          size: this.formatFileSize(file.size),
          uploader: this.generateAnonymousId(),
          fileName: file.name,
          fileType: file.type,
          location: this.getRandomLocation(),
          isChunked: false,
          owner: this.currentUser.uid // Required for security rules
        };

        this.showStatus('Uploading to Firebase securely...', 'loading');
        this.showProgress(90);

        await addDoc(collection(this.db, 'videos'), videoData);
        console.log('✅ Secure single video uploaded to Firebase');
      }

      async uploadChunkedVideo(videoId, title, videoBase64, thumbnailData, file) {
        console.log('📦 Uploading chunked video with security...');
        
        const maxChunkSize = 800000; // 800KB chunks
        const chunks = [];
        
        // Split video data into chunks
        for (let i = 0; i < videoBase64.length; i += maxChunkSize) {
          chunks.push(videoBase64.slice(i, i + maxChunkSize));
        }
        
        console.log(`📦 Split video into ${chunks.length} chunks`);
        this.showStatus(`Uploading video securely in ${chunks.length} parts...`, 'loading');

        // Upload main video document (metadata only)
        const mainVideo = {
          id: videoId,
          title: title,
          thumbnail: thumbnailData,
          uploadTime: new Date().toISOString(),
          size: this.formatFileSize(file.size),
          uploader: this.generateAnonymousId(),
          fileName: file.name,
          fileType: file.type,
          location: this.getRandomLocation(),
          isChunked: true,
          totalChunks: chunks.length,
          videoData: '', // Empty for chunked videos
          owner: this.currentUser.uid // Required for security rules
        };

        await addDoc(collection(this.db, 'videos'), mainVideo);
        
        // Upload chunks with owner field
        const chunkPromises = chunks.map((chunk, index) => {
          const chunkData = {
            videoId: videoId,
            chunkIndex: index,
            chunkData: chunk,
            uploadTime: new Date().toISOString(),
            owner: this.currentUser.uid // Required for security rules
          };
          return addDoc(collection(this.db, 'video_chunks'), chunkData);
        });

        this.showProgress(85);
        await Promise.all(chunkPromises);
        
        console.log(`✅ Secure chunked video uploaded: ${chunks.length} chunks`);
      }

      async fileToBase64(file) {
        console.log('🔄 Converting file to base64...');
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = e => resolve(e.target.result);
          reader.onerror = reject;
          reader.readAsDataURL(file);
        });
      }

      async generateThumbnail(file) {
        console.log('🖼️ Generating thumbnail...');
        return new Promise((resolve, reject) => {
          const video = document.createElement('video');
          const url = URL.createObjectURL(file);
          video.src = url;
          video.crossOrigin = 'anonymous';
          video.muted = true;
          video.preload = 'metadata';

          video.addEventListener('loadedmetadata', () => {
            video.currentTime = Math.min(video.duration * 0.25, 5);
          });

          video.addEventListener('seeked', () => {
            try {
              const canvas = document.createElement('canvas');
              const aspectRatio = video.videoWidth / video.videoHeight;
              
              canvas.width = 320;
              canvas.height = 320 / aspectRatio;
              
              const ctx = canvas.getContext('2d');
              ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
              
              URL.revokeObjectURL(url);
              resolve(canvas.toDataURL('image/jpeg', 0.7));
            } catch (error) {
              URL.revokeObjectURL(url);
              resolve(this.generateDefaultThumbnail());
            }
          });

          video.addEventListener('error', () => {
            URL.revokeObjectURL(url);
            resolve(this.generateDefaultThumbnail());
          });
        });
      }

      generateDefaultThumbnail() {
        const canvas = document.createElement('canvas');
        canvas.width = 320;
        canvas.height = 180;
        const ctx = canvas.getContext('2d');
        
        const gradient = ctx.createLinearGradient(0, 0, 320, 180);
        gradient.addColorStop(0, '#2a1e3c');
        gradient.addColorStop(1, '#1e1e2f');
        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, 320, 180);
        
        ctx.fillStyle = '#a15fcc';
        ctx.beginPath();
        ctx.moveTo(120, 60);
        ctx.lineTo(180, 90);
        ctx.lineTo(120, 120);
        ctx.closePath();
        ctx.fill();
        
        return canvas.toDataURL('image/jpeg', 0.7);
      }

      renderGallery() {
        if (this.videos.length === 0) {
          this.gallery.innerHTML = `
            <div class="empty-gallery">
              <p>📹 No videos uploaded yet.</p>
              <p>Be the first to share a video</p>
            </div>
          `;
          this.totalVideos.textContent = '0';
          return;
        }

        this.gallery.innerHTML = this.videos.map((video, index) => `
          <div class="video-card" onclick="vanishApp.showVideo(${index})" data-index="${index}">
            <div class="global-badge">Watch Now</div>
            <img src="${video.thumbnail}" alt="${video.title}" class="video-thumbnail" loading="lazy" />
            <div class="video-info">
              <h3 class="video-title">${this.escapeHtml(video.title)}</h3>
              <div class="video-meta">
                <span>${this.timeAgo(video.uploadTime)}</span>
                <span>${video.size}</span>
              </div>
              <div class="video-meta">
                <span>📍 ${video.location || 'Unknown'}</span>
                <span>👤 ${video.uploader}</span>
              </div>
            </div>
          </div>
        `).join('');

        this.totalVideos.textContent = this.videos.length;
        console.log(`✅ Gallery rendered with ${this.videos.length} videos`);
      }

      async showVideo(index) {
        console.log(`📺 Showing video ${index}`);
        const video = this.videos[index];
        if (!video) return;

        this.videoTitle.textContent = video.title;
        
        // Clean up previous blob URLs
        this.cleanupBlobUrls();
        
        try {
          let videoDataUrl;
          
          // Check if video is chunked
          if (video.isChunked) {
            console.log('📦 Loading chunked video...');
            this.showStatus('Loading video...', 'loading');
            
            videoDataUrl = await this.loadChunkedVideo(video.id);
          } else {
            // Regular video
            videoDataUrl = video.videoData;
          }
          
          // Convert base64 to blob URL for proper video playback
          const blobUrl = this.base64ToBlob(videoDataUrl);
          this.videoPlayer.src = blobUrl;
          
          this.hideStatus();
        } catch (error) {
          console.error('❌ Failed to load video:', error);
          this.showStatus('Failed to load video. Please try again.', 'error');
          return;
        }
        
        this.videoPlayer.load();
        
        this.gallery.style.display = 'none';
        this.uploadSection.style.display = 'none';
        this.videoPage.style.display = 'block';
        
        setTimeout(() => {
          this.videoPlayer.play().catch(e => {
            console.log('Auto-play prevented by browser policy');
          });
        }, 100);
      }

      base64ToBlob(base64Data) {
        console.log('🔄 Converting base64 to blob URL...');
        
        try {
          // Remove data URL prefix if present
          const base64String = base64Data.includes(',') ? base64Data.split(',')[1] : base64Data;
          const mimeType = base64Data.includes(',') ? base64Data.split(',')[0].split(':')[1].split(';')[0] : 'video/mp4';
          
          // Convert base64 to binary
          const byteCharacters = atob(base64String);
          const byteNumbers = new Array(byteCharacters.length);
          
          for (let i = 0; i < byteCharacters.length; i++) {
            byteNumbers[i] = byteCharacters.charCodeAt(i);
          }
          
          const byteArray = new Uint8Array(byteNumbers);
          const blob = new Blob([byteArray], { type: mimeType });
          
          // Create blob URL
          const blobUrl = URL.createObjectURL(blob);
          this.currentBlobUrls.add(blobUrl);
          
          console.log(`✅ Created blob URL: ${blobUrl.substring(0, 50)}...`);
          return blobUrl;
          
        } catch (error) {
          console.error('❌ Failed to convert base64 to blob:', error);
          // Fallback to direct base64
          return base64Data;
        }
      }

      cleanupBlobUrls() {
        console.log('🧹 Cleaning up blob URLs...');
        this.currentBlobUrls.forEach(url => {
          URL.revokeObjectURL(url);
        });
        this.currentBlobUrls.clear();
      }

      async loadChunkedVideo(videoId) {
        if (!this.isAuthenticated) {
          throw new Error('Authentication required to load video chunks');
        }

        console.log(`📦 Loading chunks for video ${videoId}...`);
        
        try {
          // Get all chunks for this video - use only where clause to avoid index requirement
          const chunksRef = collection(this.db, 'video_chunks');
          const q = query(chunksRef, where('videoId', '==', videoId));
          const querySnapshot = await getDocs(q);
          
          const chunks = [];
          querySnapshot.forEach((doc) => {
            const data = doc.data();
            chunks[data.chunkIndex] = data.chunkData;
          });
          
          console.log(`📦 Loaded ${chunks.length} chunks`);
          
          // Sort chunks by index (since we can't use orderBy)
          const sortedChunks = [];
          for (let i = 0; i < chunks.length; i++) {
            if (chunks[i] !== undefined) {
              sortedChunks.push(chunks[i]);
            }
          }
          
          // Combine all chunks
          const completeVideoData = sortedChunks.join('');
          
          // Find the original base64 prefix from the first chunk
          const firstChunk = sortedChunks[0];
          if (firstChunk && firstChunk.startsWith('data:')) {
            const prefixEnd = firstChunk.indexOf(',') + 1;
            const prefix = firstChunk.substring(0, prefixEnd);
            return prefix + sortedChunks.join('').substring(prefixEnd);
          }
          
          return completeVideoData;
          
        } catch (error) {
          console.error('❌ Failed to load video chunks:', error);
          throw error;
        }
      }

      showGallery() {
        console.log('🏠 Showing gallery');
        this.videoPlayer.pause();
        this.videoPlayer.src = '';
        
        // Clean up blob URLs when leaving video page
        this.cleanupBlobUrls();
        
        this.videoPage.style.display = 'none';
        this.gallery.style.display = 'grid';
        this.uploadSection.style.display = 'block';
        
        this.hideStatus();
      }

      startStatsUpdater() {
        this.updateStats();
        setInterval(() => this.updateStats(), 30000);
      }

      updateStats() {
        // Calculate time until midnight CST
        const now = new Date();
        const cstOffset = -6 * 60; // CST is UTC-6
        const nowCST = new Date(now.getTime() + (now.getTimezoneOffset() + cstOffset) * 60 * 1000);
        
        const tomorrow = new Date(nowCST);
        tomorrow.setDate(tomorrow.getDate() + 1);
        tomorrow.setHours(0, 0, 0, 0);
        
        const timeUntilMidnight = tomorrow - nowCST;
        const hours = Math.floor(timeUntilMidnight / (1000 * 60 * 60));
        const minutes = Math.floor((timeUntilMidnight % (1000 * 60 * 60)) / (1000 * 60));
        
        this.timeToMidnight.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
      }

      startMidnightCleaner() {
        console.log('🕛 Starting midnight cleaner...');
        
        // Check every minute if it's midnight CST
        setInterval(async () => {
          const now = new Date();
          const cstOffset = -6 * 60; // CST is UTC-6
          const nowCST = new Date(now.getTime() + (now.getTimezoneOffset() + cstOffset) * 60 * 1000);
          
          // Check if it's midnight CST (00:00)
          if (nowCST.getHours() === 0 && nowCST.getMinutes() === 0) {
            console.log('🕛 MIDNIGHT CST! Deleting all videos...');
            await this.deleteAllVideos();
          }
        }, 60000); // Check every minute
      }

      async deleteAllVideos() {
        if (!this.isAuthenticated) {
          console.log('⚠️ Cannot delete videos - user not authenticated');
          return;
        }

        try {
          console.log('🗑️ Deleting all videos from Firebase...');
          this.showStatus('🕛 Midnight reset! Deleting all videos...', 'loading');
          
          // Delete all videos
          const videosRef = collection(this.db, 'videos');
          const videosSnapshot = await getDocs(videosRef);
          
          const deletePromises = [];
          videosSnapshot.forEach((doc) => {
            deletePromises.push(deleteDoc(doc.ref));
          });
          
          // Delete all video chunks
          const chunksRef = collection(this.db, 'video_chunks');
          const chunksSnapshot = await getDocs(chunksRef);
          
          chunksSnapshot.forEach((doc) => {
            deletePromises.push(deleteDoc(doc.ref));
          });
          
          // Delete all active users (clean slate for new day)
          const activeUsersRef = collection(this.db, 'active_users');
          const activeUsersSnapshot = await getDocs(activeUsersRef);
          
          activeUsersSnapshot.forEach((doc) => {
            deletePromises.push(deleteDoc(doc.ref));
          });
          
          await Promise.all(deletePromises);
          
          console.log('✅ All videos, chunks, and user sessions deleted successfully!');
          this.showStatus('🌅 Fresh start! All videos have been deleted at midnight CST.', 'success');
          
          setTimeout(() => {
            this.hideStatus();
          }, 5000);
          
        } catch (error) {
          console.error('❌ Failed to delete videos:', error);
          this.showStatus('Failed to delete videos. Please refresh the page.', 'error');
        }
      }

      generateAnonymousId() {
        return 'anon_' + Math.random().toString(36).substr(2, 6);
      }

      getRandomLocation() {
        const locations = [
          'Newton, KS'
        ];
        return locations[Math.floor(Math.random() * locations.length)];
      }

      showStatus(message, type) {
        this.status.textContent = message;
        this.status.className = `status ${type}`;
        this.status.style.display = 'block';
      }

      hideStatus() {
        this.status.style.display = 'none';
      }

      showProgress(percent) {
        this.uploadProgress.style.display = 'block';
        this.uploadProgressBar.style.width = percent + '%';
      }

      hideProgress() {
        this.uploadProgress.style.display = 'none';
        this.uploadProgressBar.style.width = '0%';
      }

      formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
      }

      timeAgo(dateString) {
        const now = new Date();
        const past = new Date(dateString);
        const diffInMinutes = Math.floor((now - past) / (1000 * 60));
        
        if (diffInMinutes < 1) return 'Just now';
        if (diffInMinutes < 60) return `${diffInMinutes}m ago`;
        if (diffInMinutes < 1440) return `${Math.floor(diffInMinutes / 60)}h ago`;
        return `${Math.floor(diffInMinutes / 1440)}d ago`;
      }

      escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }
    }

    // Initialize the app and make it globally accessible
    window.vanishApp = new VanishGlobalPlatform();
  </script>

</body></html>
